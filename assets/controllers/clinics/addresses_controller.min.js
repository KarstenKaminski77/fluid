import{Controller}from"@hotwired/stimulus";import intlTelInput from"intl-tel-input";export default class extends Controller{iti;connect(e){let uri=window.location.pathname;let isAddresses=uri.match("/clinics/addresses");if(isAddresses!=null){this.iti=this.getAddresses(1)}}onClickAddressesLink(e){e.preventDefault();this.getAddresses(1)}onClickAddressNew(){this.manageModalBackdrop();$("#address_id").val(0);$("#address_clinic_name").val("");$("#address_mobile").val("");$("#address_line_1").val("");$("#address_modal_label").empty().append("Create An Address")}onClickAddressUpdate(e){let self=this;let clickedElement=e.currentTarget;let addressId=$(clickedElement).data("address-id");$(".modal-backdrop:first").remove();this.iti.destroy();$.ajax({async:"true",url:"/get-address",type:"POST",data:{id:addressId},success:function(response){$("#address_clinic_name").val(response.clinic_name);$("#address_telephone").val(response.telephone);$("#address_mobile").val(response.telephone);$("#address_iso_code").val(response.iso_code);$("#address_intl_code").val(response.intl_code);$("#address_line_1").val(response.address);$("option").attr("selected",false);if(response.type==1){$("#option_billing").attr("selected",true)}if(response.type==2){$("#option_shipping").attr("selected",true)}self.input=document.querySelector("#address_mobile");self.iti=window.intlTelInput(self.input,{preferredCountries:["ae","qa","bh","om","sa"],initialCountry:response.iso_code,autoPlaceholder:"polite",nationalMode:true,separateDialCode:true,utilsScript:"/js/utils.js"})}});$("#address_id").val(addressId);$("#address_modal_label").empty().append("Update An Address")}onKeyUpMobile(e){let input=this.input;let iti=this.iti;$("#address_telephone").val("");$("#address_iso_code").val("");$("#address_intl_code").val("");let handleChange=function(){let mobile=$("#address_telephone");let mobile_number=iti.isValidNumber?iti.getNumber():false;let textNode=document.createTextNode(mobile_number);if(mobile_number!=false){let isoCode=iti.getSelectedCountryData().iso2;let intlCode=iti.getSelectedCountryData().dialCode;mobile.val(mobile_number.substring(1));$("#address_iso_code").val(isoCode);$("#address_intl_code").val(intlCode)}};input.addEventListener("change",handleChange);input.addEventListener("keyup",handleChange);input.addEventListener("keyup",handleChange())}getAddresses(pageId){let self=this;let page=$("html").html();$.ajax({async:"true",url:"/clinics/get-clinic-addresses",type:"POST",dataType:"json",data:{"page-id":pageId,permissions:$.session.get("permissions")},beforeSend:function(){self.isLoading(true)},complete:function(e,xhr,settings){if(e.status===500){window.location.href="/clinics/error"}self.input=document.querySelector("#address_mobile");self.iti=window.intlTelInput(self.input,{preferredCountries:["ae","qa","bh","om","sa"],autoPlaceholder:"polite",nationalMode:true,separateDialCode:true,utilsScript:"/js/utils.js"});return self.iti},success:function(response){$("#clinic_container").empty().removeClass("col-container").append(response.html).show();$("#clinic_container").append(response.pagination);window.scrollTo(0,0);self.isLoading(false);window.history.pushState(null,"Fluid","/clinics/addresses")}})}onClickPagination(e){e.preventDefault();let clickedElement=e.currentTarget;let pageId=$(clickedElement).data("page-id");this.getAddresses(pageId)}onClickDeleteIcon(e){e.preventDefault();this.manageModalBackdrop();$("#delete_address").attr("data-address-id",$(e.currentTarget).data("address-id"))}onClickDelete(e){let self=this;let clickedElement=e.currentTarget;let addressId=$(clickedElement).data("address-id");let pageId=$("#page_no").val();$.ajax({async:"true",url:"/clinics/address/delete",type:"POST",data:{id:addressId,"page-id":pageId},beforeSend:function(){self.isLoading(true)},success:function(response){self.getFlash(response.flash);$("#clinic_container").empty().append(response.addresses);$("#clinic_container").append(response.pagination).show();$("#modal_address_delete").modal("hide");$(".modal-backdrop").removeClass("modal-backdrop");$("#modal_address_delete").addClass("fade");self.isLoading(false);$("body").removeAttr("style")}})}onClickDefaultShipping(e){e.preventDefault();let self=this;let clickedElement=e.currentTarget;let addressId=$(clickedElement).data("address-id");let pageId=$("#page_no").val();$.ajax({async:"true",url:"/clinics/address/default",type:"POST",dataType:"json",data:{id:addressId,"page-id":pageId},beforeSend:function(){self.isLoading(true)},success:function(response){self.getFlash(response.flash);$("#clinic_container").empty().append(response.addresses);$("#clinic_container").append(response.pagination).show();self.isLoading(false)}})}onClickDefaultBillingAddress(e){e.preventDefault();let self=this;let clickedElement=e.currentTarget;let addressId=$(clickedElement).data("billing-address-id");let pageId=$("#page_no").val();$.ajax({async:"true",url:"/clinics/address/default-billing",type:"POST",dataType:"json",data:{id:addressId,"page-id":pageId},beforeSend:function(){self.isLoading(true)},success:function(response){self.getFlash(response.flash);$("#clinic_container").empty().append(response.addresses);$("#clinic_container").append(response.pagination).show();self.isLoading(false)}})}onSubmitAddressForm(e){e.preventDefault();let self=this;let clickedElement=e.currentTarget;let isValid=true;let clinicName=$("#address_clinic_name").val();let telephone=$("#address_telephone").val();let addressLine1=$("#address_line_1").val();let type=$("#address_type").val();let errorClinicName=$("#error_address_clinic_name");let errorTelephone=$("#error_address_telephone");let errorAddressLine1=$("#error_address_line_1");let errorType=$("#error_address_type");errorClinicName.hide();errorTelephone.hide();errorAddressLine1.hide();errorType.hide();if(clinicName==""||clinicName=="undefined"){errorClinicName.show();isValid=false}if(telephone==""||telephone=="undefined"){errorTelephone.show();isValid=false}if(addressLine1==""||addressLine1=="undefined"){errorAddressLine1.show();isValid=false}if(type==""||type=="undefined"){errorType.show();isValid=false}if(isValid==true){$("<input />").attr("type","hidden").attr("name","page_id").attr("value",$("#page_no").val()).appendTo("#form_addresses");let data=new FormData($(clickedElement)[0]);$.ajax({async:"true",url:"/clinics/update-address",type:"POST",contentType:false,processData:false,cache:false,timeout:6e5,dataType:"json",data:data,beforeSend:function(){self.isLoading(true)},success:function(response){self.getFlash(response.flash);$("#clinic_container").empty().append(response.addresses);$("#clinic_container").append(response.pagination).show();$("#modal_address").modal("hide");$(".modal-backdrop").removeClass("modal-backdrop");$("body").removeAttr("style");$(".fade").removeClass("fade");self.isLoading(false);$("#address_clinic_name").val("");$("#address_telephone").val("");$("#address_line_1").val("");$("#address_suite").val("");$("#address_postal_code").val("");$("#address_city").val("");$("#address_state").val("")}})}}onclickBtnMap(e){let visible=$("#address_map").is(":visible");let width=$(window).width();let modalHeight=$("#modal_address .modal-body").height();$("#address_map").toggle(700);if(visible==false){let height=$("#modal_address .modal-body").height();$.session.set("modal_height",height);if(width<579){$("#modal_address .modal-body").css("height",modalHeight+370)}else{$("#modal_address .modal-body").css("height",modalHeight+370)}}else{$("#modal_address .modal-body").css("height",$.session.get("modal_height"))}}onClickShippingModal(){let self=this;$.ajax({async:"true",url:"/clinics/get-address-modal/2",type:"GET",dataType:"json",success:function(response){$("#billing_address_modal").empty();$(".modal-backdrop:first").remove();$("#shipping_address_modal").empty().append(response.modal);$("#address_type").attr("readonly",true);$("#option_shipping").attr("selected",true);$("#modal_header_address").empty().append('<h5 class="modal-title" id="address_modal_label">Use an Existing Address</h5>').append('<span class="badge bg-success ms-3 toggle_address" role="button" data-action="click->clinics--addresses#onClickToggle">Create A New Address</span>').append('<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>');$(".modal-body-address-new").hide();$(".modal-body-address-existing").show();$("body").removeAttr("style");self.input=document.querySelector("#address_mobile");self.iti=self.initIntlTel(response.iso_code)}})}onSubmitCheckoutShipping(e){e.preventDefault();let self=this;let clickedElement=e.currentTarget;let data=new FormData($(clickedElement)[0]);let addressId=data.get("address");if(addressId==null){let isValid=true;let clinicName=$("#address_clinic_name").val();let telephone=$("#address_telephone").val();let addressLine1=$("#address_line_1").val();let postalCode=$("#address_postal_code").val();let city=$("#address_city").val();let state=$("#address_state").val();let type=$("#address_type").val();let errorClinicName=$("#error_address_clinic_name");let errorTelephone=$("#error_address_telephone");let errorAddressLine1=$("#error_address_line_1");let errorPostalCode=$("#error_address_postal_code");let errorCity=$("#error_address_city");let errorState=$("#error_address_state");let errorType=$("#error_address_type");errorClinicName.hide();errorTelephone.hide();errorAddressLine1.hide();errorPostalCode.hide();errorCity.hide();errorState.hide();errorType.hide();if(clinicName==""||clinicName=="undefined"){errorClinicName.show();isValid=false}if(telephone==""||telephone=="undefined"){errorTelephone.show();isValid=false}if(addressLine1==""||addressLine1=="undefined"){errorAddressLine1.show();isValid=false}if(city==""||city=="undefined"){errorCity.show();isValid=false}if(postalCode==""||postalCode=="undefined"){errorPostalCode.show();isValid=false}if(state==""||state=="undefined"){errorState.show();isValid=false}if(type==""||type=="undefined"){errorType.show();isValid=false}if(isValid==true){$.ajax({async:"true",url:"/clinics/update-address",type:"POST",contentType:false,processData:false,cache:false,timeout:6e5,dataType:"json",data:data,beforeSend:function(){self.isLoading(true)},success:function(response){$("#checkout_shipping_address").empty().append(response.checkout_address);$("#modal_shipping_address").modal("hide");$(".modal-backdrop").removeClass("modal-backdrop");$("#modal_shipping_address").addClass("fade");$("#address_clinic_name").val("");$("#address_telephone").val("");$("#address_line_1").val("");$("#address_suite").val("");$("#address_postal_code").val("");$("#address_city").val("");$("#address_state").val("");$("#shipping_address_id").val(response.checkout_address_id);self.isLoading(false);$("body").removeAttr("style")}})}}else{$.ajax({async:"true",url:"/get-address",type:"POST",dataType:"json",data:{id:addressId},beforeSend:function(){self.isLoading(true)},success:function(response){$("#modal_shipping_address").modal("toggle");$("#shipping_address_id").val(addressId);$("#checkout_shipping_address").empty().append(response.address);self.isLoading(false);$("body").removeAttr("style")}})}}onClickBillingModal(){let self=this;$.ajax({async:"true",url:"/clinics/get-address-modal/1",type:"GET",dataType:"json",success:function(response){$("#shipping_address_modal").empty();$(".modal-backdrop:first").remove();$("#billing_address_modal").empty().append(response.modal);$("#modal_header_address").empty().append('<h5 class="modal-title" id="address_modal_label">Use an Existing Address</h5>').append('<span class="badge bg-success ms-3 toggle_address" role="button" data-action="click->clinics--addresses#onClickToggle">Create A New Address</span>').append('<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>');$(".modal-body-address-new").hide();$(".modal-body-address-existing").show();$("body").removeAttr("style");self.input=document.querySelector("#address_mobile");self.iti=self.initIntlTel(response.iso_code)}})}onSubmitCheckoutBilling(e){e.preventDefault();let self=this;let isValid=true;let clickedElement=e.currentTarget;let data=new FormData($(clickedElement)[0]);let addressId=data.get("address");if(addressId==null){let clinicName=$("#address_clinic_name").val();let telephone=$("#address_telephone").val();let addressLine1=$("#address_line_1").val();let type=$("#address_type").val();let errorClinicName=$("#error_address_clinic_name");let errorTelephone=$("#error_address_telephone");let errorAddressLine1=$("#error_address_line_1");let errorType=$("#error_address_type");errorClinicName.hide();errorTelephone.hide();errorAddressLine1.hide();errorType.hide();if(clinicName==""||clinicName=="undefined"){errorClinicName.show();isValid=false}if(telephone==""||telephone=="undefined"){errorTelephone.show();isValid=false}if(addressLine1==""||addressLine1=="undefined"){errorAddressLine1.show();isValid=false}if(type==""||type=="undefined"){errorType.show();isValid=false}if(isValid==true){$("<input />").attr("type","hidden").attr("name","page_id").attr("value",$("#page_no").val()).appendTo("#form_addresses");$.ajax({async:"true",url:"/clinics/update-address",type:"POST",contentType:false,processData:false,cache:false,timeout:6e5,dataType:"json",data:data,beforeSend:function(){self.isLoading(true)},success:function(response){$("#checkout_billing_address").empty().append(response.checkout_address);$("#modal_billing_address").modal("toggle");$("#address_clinic_name").val("");$("#address_telephone").val("");$("#address_mobile").val("");$("#address_line_1").val("");$("#billing_address_id").val(response.checkout_address_id);self.isLoading(false);$("body").removeAttr("style")}})}}else{let id=data.get("address");$.ajax({async:"true",url:"/get-address",type:"POST",dataType:"json",data:{id:id},success:function(response){$("#modal_billing_address").modal("toggle");$("#billing_address_id").val(id);$("#checkout_billing_address").empty().append(response.address);$("body").removeAttr("style")}})}}onClickCheckoutShippingMap(){let visible=$("#address_map").is(":visible");let width=$(window).width();let modalHeight=$("#modal_shipping_address .modal-body").height();$("#address_map").toggle(700);if(visible==false){let height=$("#modal_shipping_address .modal-body").height();$.session.set("modalHeight",height);if(width<579){$("#modal_shipping_address .modal-body").css("height",modalHeight+570)}else{$("#modal_shipping_address .modal-body").css("height",modalHeight+370)}}else{$("#modal_shipping_address .modal-body").css("height",$.session.get("modalHeight"))}}onClickCheckoutBillingMap(){let visible=$("#address_map").is(":visible");let width=$(window).width();let modalHeight=$("#billing_address_modal .modal-body").height();$("#address_map").toggle(700);if(visible==false){let height=$("#billing_address_modal .modal-body").height();$.session.set("modal_height",height);if(width<579){$("#billing_address_modal .modal-body").css("height",modalHeight+570)}else{$("#billing_address_modal .modal-body").css("height",modalHeight+370)}}else{$("#billing_address_modal .modal-body").css("height",$.session.get("modal_height"))}}onClickToggle(e){e.preventDefault();if($(".modal-body-address-new:visible").is(":visible")){$("#modal_header_address").empty().append('<h5 class="modal-title" id="address_modal_label">Use an Existing Address</h5>').append('<span class="badge bg-success ms-3 toggle_address" role="button" data-action="click->clinics--addresses#onClickToggle">Create A New Address</span>').append('<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>');$(".existing-address").attr("disabled",false)}else{$("#modal_header_address").empty().append('<h5 class="modal-title" id="address_modal_label">Create A New Address</h5>').append('<span class="badge bg-success ms-3 toggle_address" role="button" data-action="click->clinics--addresses#onClickToggle">Use an Existing Address</span>').append('<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>');$(".existing-address").attr("disabled",true)}$(".modal-body-address-new").toggle();$(".modal-body-address-existing").toggle()}initIntlTel(isoCode){let input=document.querySelector("#address_mobile");let iti=window.intlTelInput(input,{preferredCountries:["ae","qa","bh","om","sa"],initialCountry:isoCode,autoPlaceholder:"polite",nationalMode:true,separateDialCode:true,utilsScript:"/js/utils.js"});return iti}manageModalBackdrop(){let backdrop=$(".modal-backdrop");if(backdrop.length>1){$(".modal-backdrop:first").remove()}if(backdrop.length==0){$("body").append('<div class="modal-backdrop show"></div>')}}getFlash(flash){$("#flash").addClass("alert-success").removeClass("alert-danger").addClass("alert").addClass("text-center");$("#flash").removeClass("users-flash").addClass("users-flash").empty().append(flash).removeClass("hidden");setTimeout(function(){$("#flash").removeClass("alert-success").removeClass("alert").removeClass("text-center");$("#flash").removeClass("users-flash").empty().addClass("hidden")},5e3)}isLoading(status){if(status){$("div.spanner").addClass("show");$("div.overlay").addClass("show")}else{$("div.spanner").removeClass("show");$("div.overlay").removeClass("show")}}}